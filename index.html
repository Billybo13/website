<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>AI + Humanity Carousel</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: black;
  color: white;
  height: 100%;
}
canvas {
  position: fixed;
  top: 0;
  left: 0;
  z-index: 0;
}
.carousel-container {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  perspective: 2000px;
  width: 80vw;
  height: 30vh;
  z-index: 1;
}
.carousel {
  width: 100%;
  height: 100%;
  transform-style: preserve-3d;
}
.carousel-panel {
  position: absolute;
  width: 80vw;
  height: 30vh;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: clamp(1rem, 2.2vw, 2.5rem);
  font-weight: bold;
  text-align: center;
  padding: 2vw;
  box-sizing: border-box;
  background: rgba(0, 0, 0, 0.4);
  border-radius: 1vw;
  backdrop-filter: blur(4px);
  transition: text-shadow 0.2s ease;
}
button {
  position: fixed;
  top: 1rem;
  left: 1rem;
  padding: 0.5rem 1rem;
  font-size: 1rem;
  background: teal;
  border: none;
  border-radius: 0.5rem;
  color: white;
  cursor: pointer;
  z-index: 2;
}
</style>
</head>
<body>
<canvas id="bg"></canvas>

<div class="carousel-container">
  <div class="carousel" id="carousel"></div>
</div>

<button id="toggleAudio">Play</button>

<script>
const quotes = [
  "AI will enhance human creativity, not replace it.",
  "Technology can amplify empathy and understanding.",
  "The future is built on collaboration between humans and machines.",
  "Artificial intelligence will help us solve global challenges.",
  "Automation can free humanity to focus on what matters most.",
  "AI can guide us toward sustainable innovation."
];

// Build carousel
const carousel = document.getElementById("carousel");
const panelCount = quotes.length;
const panelWidth = 0.8 * window.innerWidth;
const radius = Math.round((panelWidth / 2) / Math.tan(Math.PI / panelCount));

quotes.forEach((quote, i) => {
  const panel = document.createElement("div");
  panel.className = "carousel-panel";
  panel.textContent = quote;
  const angle = (360 / panelCount) * i;
  panel.style.transform = `rotateY(${angle}deg) translateZ(${radius}px)`;
  carousel.appendChild(panel);
});
const panels = document.querySelectorAll(".carousel-panel");

// Particle setup
const canvas = document.getElementById("bg");
const ctx = canvas.getContext("2d");
let particles = [];
let pointerX = window.innerWidth / 2;
let pointerY = window.innerHeight / 2;

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

class Particle {
  constructor() { this.reset(); }
  reset() {
    this.x = Math.random() * canvas.width;
    this.y = Math.random() * canvas.height;
    this.vx = (Math.random() - 0.5) * 0.4;
    this.vy = (Math.random() - 0.5) * 0.4;
    this.size = 1 + Math.random() * 2;
    this.color = "rgba(255,255,255,0.8)";
  }
  update(bass, mid, treble) {
    // Gentle drift
    this.x += this.vx;
    this.y += this.vy;

    // Wrap around edges
    if (this.x < 0) this.x = canvas.width;
    if (this.x > canvas.width) this.x = 0;
    if (this.y < 0) this.y = canvas.height;
    if (this.y > canvas.height) this.y = 0;

    // Pointer attraction
    let dx = pointerX - this.x;
    let dy = pointerY - this.y;
    let dist = Math.sqrt(dx * dx + dy * dy);
    if (dist < 150) { // pull range
      let force = (150 - dist) / 150;
      this.vx += (dx / dist) * force * 0.05;
      this.vy += (dy / dist) * force * 0.05;
    }

    // Music reactivity
    const hue = (treble * 3 + bass) % 360;
    this.color = `hsl(${hue}, 100%, ${60 + bass / 4}%)`;
    this.size = 1 + bass / 80;
  }
  draw() {
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
    ctx.fillStyle = this.color;
    ctx.fill();
  }
}

for (let i = 0; i < 300; i++) particles.push(new Particle());

// Audio setup
let audioCtx, analyser, dataArray, source;
let isPlaying = false;
const audioBtn = document.getElementById("toggleAudio");

audioBtn.addEventListener("click", () => {
  if (!isPlaying) {
    if (!audioCtx) {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      analyser = audioCtx.createAnalyser();
      analyser.fftSize = 256;
      dataArray = new Uint8Array(analyser.frequencyBinCount);

      fetch("goldberg_variations.mp3")
        .then(res => res.arrayBuffer())
        .then(buf => audioCtx.decodeAudioData(buf))
        .then(decoded => {
          source = audioCtx.createBufferSource();
          source.buffer = decoded;
          source.connect(analyser);
          analyser.connect(audioCtx.destination);
          source.start(0);
          isPlaying = true;
          audioBtn.textContent = "Pause";
        });
    } else {
      audioCtx.resume();
      isPlaying = true;
      audioBtn.textContent = "Pause";
    }
  } else {
    audioCtx.suspend();
    isPlaying = false;
    audioBtn.textContent = "Play";
  }
});

function avg(arr) {
  let sum = 0;
  for (let v of arr) sum += v;
  return sum / arr.length;
}

// Carousel interaction
let rotationY = 0;
let rotationSpeed = 0.2;
let isDragging = false;
let lastX = 0;

function applyCarouselRotation() {
  carousel.style.transform = `rotateY(${rotationY}deg)`;
}
function startDrag(x) {
  isDragging = true;
  lastX = x;
}
function dragMove(x) {
  if (!isDragging) return;
  let delta = x - lastX;
  lastX = x;
  rotationSpeed = delta * 0.1;
}
function endDrag() {
  isDragging = false;
}

window.addEventListener("mousedown", e => startDrag(e.clientX));
window.addEventListener("mousemove", e => dragMove(e.clientX));
window.addEventListener("mouseup", endDrag);

window.addEventListener("touchstart", e => {
  pointerX = e.touches[0].clientX;
  pointerY = e.touches[0].clientY;
  startDrag(pointerX);
});
window.addEventListener("touchmove", e => {
  e.preventDefault();
  pointerX = e.touches[0].clientX;
  pointerY = e.touches[0].clientY;
  dragMove(pointerX);
}, { passive: false });
window.addEventListener("touchend", endDrag);

window.addEventListener("mousemove", e => {
  pointerX = e.clientX;
  pointerY = e.clientY;
});

function animate() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  let bass = 0, mid = 0, treble = 0;
  if (isPlaying && analyser) {
    analyser.getByteFrequencyData(dataArray);
    const bassEnd = Math.floor(dataArray.length * 0.1);
    const midEnd = Math.floor(dataArray.length * 0.4);
    bass = avg(dataArray.slice(0, bassEnd));
    mid = avg(dataArray.slice(bassEnd, midEnd));
    treble = avg(dataArray.slice(midEnd));
  }

  // Carousel rotation
  rotationY += rotationSpeed;
  if (!isDragging) {
    if (Math.abs(rotationSpeed) < 0.2) {
      rotationSpeed += (0.2 - rotationSpeed) * 0.05;
    }
  }
  applyCarouselRotation();

  // Particles update/draw
  particles.forEach(p => { p.update(bass, mid, treble); p.draw(); });

  // Glow
  const hue = (treble * 3 + bass) % 360;
  const glowSize = Math.max(10, treble / 1.5);
  const glow = `0 0 ${glowSize}px hsl(${hue}, 100%, 60%)`;
  panels.forEach(panel => panel.style.textShadow = "");
  let index = Math.round(rotationY / (360 / panelCount)) % panelCount;
  if (index < 0) index += panelCount;
  panels[index].style.textShadow = glow;

  requestAnimationFrame(animate);
}

animate();
</script>
</body>
</html>