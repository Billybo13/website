<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI + Humanity</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: black;
  color: white;
  height: 100%;
}
canvas {
  position: fixed;
  top: 0;
  left: 0;
  z-index: 0;
  pointer-events: none;
}
.carousel-container {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  perspective: 2000px;
  width: 80vw;
  height: 30vh;
  z-index: 1;
}
.carousel {
  width: 100%;
  height: 100%;
  transform-style: preserve-3d;
}
.carousel-panel {
  position: absolute;
  width: 80vw;
  height: 30vh;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: clamp(1rem, 2.2vw, 2.5rem);
  font-weight: bold;
  text-align: center;
  padding: 2vw;
  box-sizing: border-box;
  background: rgba(0, 0, 0, 0.4);
  border-radius: 1vw;
  backdrop-filter: blur(4px);
  transition: text-shadow 0.2s ease;
}
button {
  position: fixed;
  top: 1rem;
  left: 1rem;
  padding: 0.5rem 1rem;
  font-size: 1rem;
  background: teal;
  border: none;
  border-radius: 0.5rem;
  color: white;
  cursor: pointer;
  z-index: 2;
}
</style>
</head>
<body>
<canvas id="bg"></canvas>

<div class="carousel-container">
  <div class="carousel" id="carousel"></div>
</div>

<button id="toggleAudio">Play</button>

<script>
const quotes = [
  "AI will enhance human creativity, not replace it.",
  "Technology can amplify empathy and understanding.",
  "The future is built on collaboration between humans and machines.",
  "Artificial intelligence will help us solve global challenges.",
  "Automation can free humanity to focus on what matters most.",
  "AI can guide us toward sustainable innovation."
];

// Build carousel
const carousel = document.getElementById('carousel');
const panelCount = quotes.length;
const panelWidth = 0.8 * window.innerWidth;
const radius = Math.round((panelWidth / 2) / Math.tan(Math.PI / panelCount));

quotes.forEach((quote, i) => {
  const panel = document.createElement('div');
  panel.className = 'carousel-panel';
  panel.textContent = quote;
  const angle = (360 / panelCount) * i;
  panel.style.transform = `rotateY(${angle}deg) translateZ(${radius}px)`;
  carousel.appendChild(panel);
});

const panels = document.querySelectorAll('.carousel-panel');

// Particle setup
const canvas = document.getElementById('bg');
const ctx = canvas.getContext('2d', { alpha: true });
let particles = [];
let centerX = window.innerWidth / 2;
let centerY = window.innerHeight / 2;

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  centerX = canvas.width / 2;
  centerY = canvas.height / 2;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

class Particle {
  constructor() { this.reset(); }
  reset() {
    const angle = Math.random() * Math.PI * 2;
    const dist = radius + 100 + Math.random() * 200; // keep around carousel
    this.x = centerX + Math.cos(angle) * dist;
    this.y = centerY + Math.sin(angle) * dist;
    this.vx = 0;
    this.vy = 0;
    this.size = 1 + Math.random() * 2;
    this.color = 'rgba(255,255,255,0.9)';
  }
  update(bass, mid, treble) {
    // Orbiting motion
    const dx = this.x - centerX;
    const dy = this.y - centerY;
    const dist = Math.sqrt(dx * dx + dy * dy);
    const angle = Math.atan2(dy, dx) + 0.002 * (1 + mid / 200);
    const targetX = centerX + Math.cos(angle) * dist;
    const targetY = centerY + Math.sin(angle) * dist;

    this.vx += (targetX - this.x) * 0.02;
    this.vy += (targetY - this.y) * 0.02;

    // Audio-reactive radial motion
    const radialPush = (bass - 100) * 0.02;
    this.vx += (dx / dist) * radialPush * 0.001;
    this.vy += (dy / dist) * radialPush * 0.001;

    this.x += this.vx;
    this.y += this.vy;

    this.vx *= 0.92;
    this.vy *= 0.92;

    const hue = (treble * 3 + bass) % 360;
    this.color = `hsl(${hue}, 100%, ${60 + bass / 4}%)`;
  }
  draw() {
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
    ctx.fillStyle = this.color;
    ctx.fill();
  }
}

for (let i = 0; i < 250; i++) particles.push(new Particle());

// Audio setup
let audioCtx, analyser, dataArray, source;
let isPlaying = false;
const audioBtn = document.getElementById('toggleAudio');

audioBtn.addEventListener('click', () => {
  if (!isPlaying) {
    if (!audioCtx) {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      analyser = audioCtx.createAnalyser();
      analyser.fftSize = 256;
      dataArray = new Uint8Array(analyser.frequencyBinCount);

      fetch('goldberg_variations.mp3')
        .then(res => res.arrayBuffer())
        .then(buf => audioCtx.decodeAudioData(buf))
        .then(decoded => {
          source = audioCtx.createBufferSource();
          source.buffer = decoded;
          source.connect(analyser);
          analyser.connect(audioCtx.destination);
          source.start(0);
          isPlaying = true;
          audioBtn.textContent = 'Pause';
        });
    } else {
      audioCtx.resume();
      isPlaying = true;
      audioBtn.textContent = 'Pause';
    }
  } else {
    audioCtx.suspend();
    isPlaying = false;
    audioBtn.textContent = 'Play';
  }
});

function avg(arr) {
  let sum = 0;
  for (let v of arr) sum += v;
  return sum / arr.length;
}

// Carousel rotation interaction
let rotationY = 0;
let rotationSpeed = 0.02; // default slow spin
let isDragging = false;
let lastX = 0;

function applyCarouselRotation() {
  carousel.style.transform = `rotateY(${rotationY}deg)`;
}

function startDrag(x) {
  isDragging = true;
  lastX = x;
}
function dragMove(x) {
  if (!isDragging) return;
  let delta = x - lastX;
  lastX = x;
  rotationSpeed = delta * 0.1; // speed based on drag amount
}
function endDrag() {
  isDragging = false;
}

window.addEventListener('mousedown', e => startDrag(e.clientX));
window.addEventListener('mousemove', e => dragMove(e.clientX));
window.addEventListener('mouseup', endDrag);

window.addEventListener('touchstart', e => startDrag(e.touches[0].clientX));
window.addEventListener('touchmove', e => {
  e.preventDefault();
  dragMove(e.touches[0].clientX);
}, { passive: false });
window.addEventListener('touchend', endDrag);

function animate() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  let bass = 0, mid = 0, treble = 0;
  if (isPlaying && analyser) {
    analyser.getByteFrequencyData(dataArray);
    const bassEnd = Math.floor(dataArray.length * 0.1);
    const midEnd = Math.floor(dataArray.length * 0.4);
    bass = avg(dataArray.slice(0, bassEnd));
    mid = avg(dataArray.slice(bassEnd, midEnd));
    treble = avg(dataArray.slice(midEnd));
  }

  // Update rotation
  rotationY += rotationSpeed;
  rotationSpeed *= 0.96; // friction so it slows if untouched
  if (!isDragging && Math.abs(rotationSpeed) < 0.02) {
    rotationSpeed += (0.02 - rotationSpeed) * 0.05; // ease back to default slow spin
  }
  applyCarouselRotation();

  // Particles
  particles.forEach(p => {
    p.update(bass, mid, treble);
    p.draw();
  });

  // Dynamic glow
  const hue = (treble * 3 + bass) % 360;
  const glowSize = Math.max(10, treble / 1.5);
  const glow = `0 0 ${glowSize}px hsl(${hue}, 100%, 60%)`;
  panels.forEach(panel => panel.style.textShadow = '');
  let index = Math.round(rotationY / (360 / panelCount)) % panelCount;
  if (index < 0) index += panelCount;
  panels[index].style.textShadow = glow;

  requestAnimationFrame(animate);
}

animate();
</script>
</body>
</html>