<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AI + Humanity — Immersive</title>
<style>
html,body{
  margin:0; padding:0;
  background:black; color:white;
  overflow:hidden; height:100%;
  font-family: 'Inter', sans-serif;
}
#bgCanvas{
  position:fixed; top:0; left:0; width:100%; height:100%;
  z-index:-1;
}
.carousel-container{
  position:absolute;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  perspective: 1000px;
  width: 800px; height: 200px;
}
.carousel{
  width:100%; height:100%;
  transform-style: preserve-3d;
  animation: rotateCylinder 24s linear infinite;
}
.carousel.paused{ animation-play-state: paused; }
.quote{
  position:absolute;
  width:700px; height:200px;
  left:50%; top:0;
  margin-left:-350px;
  background:rgba(255,255,255,0.05);
  backdrop-filter: blur(6px);
  border-radius: 12px;
  display:flex; align-items:center; justify-content:center;
  font-size: 1.5rem; text-align:center;
  padding:20px;
  box-shadow:0 0 15px rgba(255,255,255,0.1);
  transition: text-shadow 0.3s ease;
}
@keyframes rotateCylinder {
  0% { transform: rotateY(0deg); }
  100% { transform: rotateY(-360deg); }
}
button#playBtn{
  position:absolute;
  top:20px; left:20px;
  padding:10px 20px;
  background:linear-gradient(90deg,#10b981,#06b6d4);
  border:none; border-radius:8px;
  color:white; font-size:16px; cursor:pointer;
}
</style>
</head>
<body>
<canvas id="bgCanvas"></canvas>

<div class="carousel-container">
  <div class="carousel" id="carousel"></div>
</div>

<button id="playBtn">Play</button>

<script>
const quotes = [
  "AI can be a compass — guiding societies toward wiser decisions.",
  "When designed with empathy, AI amplifies human capacity.",
  "Augmented intelligence lets us see patterns we couldn't before.",
  "AI is a collaborator — magnifying our best intentions.",
  "Technology that augments human judgment can help democracy.",
  "From medicine to farming, AI’s insights can unlock human flourishing.",
  "The future isn't AI vs humans — it’s AI + humans co-creating."
];

// Create carousel faces
const carousel = document.getElementById('carousel');
const panelCount = quotes.length;
const angleStep = 360 / panelCount;
quotes.forEach((q,i)=>{
  const panel = document.createElement('div');
  panel.className = 'quote';
  panel.style.transform = `rotateY(${i*angleStep}deg) translateZ(400px)`;
  panel.textContent = q;
  carousel.appendChild(panel);
});

// ===== Particle System =====
const canvas = document.getElementById('bgCanvas');
const ctx = canvas.getContext('2d');
let w,h;
function resize(){
  w = canvas.width = window.innerWidth * window.devicePixelRatio;
  h = canvas.height = window.innerHeight * window.devicePixelRatio;
}
window.addEventListener('resize', resize);
resize();

class Star {
  constructor(){
    this.reset();
  }
  reset(){
    this.x = Math.random()*w;
    this.y = Math.random()*h;
    this.vx = (Math.random()-0.5)*0.3;
    this.vy = (Math.random()-0.5)*0.3;
    this.size = Math.random()*2+0.5;
    this.alpha = Math.random()*0.8+0.2;
  }
  update(mouse){
    // Drift toward mouse subtly
    const dx = (mouse.x - this.x)*0.0005;
    const dy = (mouse.y - this.y)*0.0005;
    this.vx += dx;
    this.vy += dy;
    this.x += this.vx;
    this.y += this.vy;
    if(this.x<0||this.x>w||this.y<0||this.y>h) this.reset();
  }
  draw(){
    ctx.globalAlpha = this.alpha;
    ctx.fillStyle = 'white';
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
    ctx.fill();
    ctx.globalAlpha = 1;
  }
}
let stars = Array.from({length:250}, ()=>new Star());
let mouse = {x:w/2, y:h/2};
window.addEventListener('mousemove', e=>{
  mouse.x = e.clientX * window.devicePixelRatio;
  mouse.y = e.clientY * window.devicePixelRatio;
});

// ===== Audio Setup =====
let audioCtx, analyser, dataArray, gainNode, buffer;
let isPlaying = false;
async function initAudio(){
  audioCtx = new (window.AudioContext||window.webkitAudioContext)();
  analyser = audioCtx.createAnalyser();
  analyser.fftSize = 1024;
  dataArray = new Uint8Array(analyser.frequencyBinCount);
  gainNode = audioCtx.createGain();
  gainNode.gain.value = 0.8;

  const resp = await fetch('goldberg_variations.mp3');
  const buf = await resp.arrayBuffer();
  buffer = await audioCtx.decodeAudioData(buf);
}

function playAudio(){
  const source = audioCtx.createBufferSource();
  source.buffer = buffer;
  source.connect(gainNode);
  gainNode.connect(analyser);
  analyser.connect(audioCtx.destination);
  source.start();
  return source;
}

function avgFreq(minHz, maxHz){
  const nyquist = audioCtx.sampleRate/2;
  const lowIndex = Math.floor(minHz/nyquist*dataArray.length);
  const highIndex = Math.min(dataArray.length-1, Math.floor(maxHz/nyquist*dataArray.length));
  let sum = 0;
  for(let i=lowIndex;i<=highIndex;i++) sum += dataArray[i];
  return sum/(highIndex-lowIndex+1);
}

// ===== Animation Loop =====
let audioSource;
function animate(){
  ctx.clearRect(0,0,w,h);

  if(isPlaying){
    analyser.getByteFrequencyData(dataArray);
    const bass = avgFreq(20,250);
    const mid = avgFreq(250,2000);
    const treble = avgFreq(2000,8000);

    // Bass bursts
    if(bass>40){
      for(let i=0;i<5;i++){
        const s = stars[Math.floor(Math.random()*stars.length)];
        s.vx += (Math.random()-0.5)*2;
        s.vy += (Math.random()-0.5)*2;
      }
    }

    // Treble glow
    const panels = document.querySelectorAll('.quote');
    panels.forEach(p=>{
      p.style.textShadow = `0 0 ${treble/5}px rgba(255,255,255,0.8)`;
    });
  }

  stars.forEach(s=>{
    s.update(mouse);
    s.draw();
  });

  requestAnimationFrame(animate);
}

// ===== Play Button =====
document.getElementById('playBtn').addEventListener('click', async ()=>{
  if(!audioCtx){
    await initAudio();
  }
  if(!isPlaying){
    if(audioCtx.state === "suspended") await audioCtx.resume();
    audioSource = playAudio();
    isPlaying = true;
    document.getElementById('playBtn').textContent = "Pause";
    requestAnimationFrame(animate);
  } else {
    audioCtx.suspend();
    isPlaying = false;
    document.getElementById('playBtn').textContent = "Play";
  }
});
</script>
</body>
</html>
